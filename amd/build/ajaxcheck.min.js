define(["jquery","core/ajax","core/notification","core/event"],function(a,b,c,d){var e,f,g=function(){return a("div.que input.submit")},h=function(b){return a("div#q"+b+" div.outcome")},i=function(b){return a("div#q"+b)},j=function(b){i(b.slot).replaceWith(b.html),d.notifyFilterContentUpdated(a(i(b.slot))),h(b.slot).hide().slideDown("slow"),a("body").css("cursor","default"),n();for(var c=0;c<b.sequencechecks.length;c++){var e=b.sequencechecks[c].sequencecheck,f=b.sequencechecks[c].fieldprefix;a('input[name="'+f+':sequencecheck"]').val(e)}},k=function(b){a("#mod_quiz_navblock div.content").html(b.navigationpanelhtml)},l=function(d){if(""!=d.target.name){d.preventDefault();var f=a(this.form).serializeArray();f.push({name:d.target.name,value:d.target.value}),a("body").css("cursor","progress"),a(d.target).prop("disabled","disabled"),a(d.target).prop("value",e);for(var g=null,h=null,i=0;i<f.length;i++)"thispage"==f[i].name?h=f[i].value:"attempt"==f[i].name&&(g=f[i].value);var l=Number(a(d.target).closest("div.que").attr("id").substring(1)),m=b.call([{methodname:"quizaccess_ajaxcheck_process_attempt",args:{attemptid:g,data:f}},{methodname:"quizaccess_ajaxcheck_get_question_html",args:{attemptid:g,page:h,submitbuttonslot:l}},{methodname:"quizaccess_ajaxcheck_get_navigation_panel_html",args:{attemptid:g,page:h}}]);m[0].fail(c.exception),m[1].done(j).fail(c.exception),m[2].done(k).fail(c.exception)}},m=function(b){var c=a(b).attr("class").split(" ")[1];return a.inArray(c,f)!==-1},n=function(){g().each(function(){m(a(this).closest("div.que"))&&a(this).click(l)})},o=function(a,b){e=a,f=b,n()};return{setup:o}});